https://event.cloudnativedays.jp/cndt2023/talks/2051

## ゾーン障害

- ストレージの機器障害が属する
- データセンターの電源とか設備障害が発生した時に波及範囲をとどめた企画

## ゾーン障害とは

- it機器の障害だけでなく電源や空調などの障害でゾーン全体がダウン
- ゾーンが死ぬとサービスが死ぬ。
- ストレージに関してはゾーン障害は悪夢でしかない。やばい。
- ゾーン障害に関しては手を抜かない方が良い。

## k8sのゾーン障害対策

- パターン1
    - ゾーンを分けてクラスタ構築
    - podをゾーンに複数台のせる
- パターン2
    - ZoneAとB二つのゾーンを作る
        - ロードバランサーが大変
        - 管理が複雑

管理性を考慮するとパターン１がおすすめ

## ゾーンを意識したpodを配置

nodeに付与されたラベルを使いpodをできるだけ分散させる

## wait for first consumer

pvのアタッチ先を決める

pvcを利用するpodが作成されるまでバインディングを遅らせるノード

### volumeの配置の考慮が漏れているとしょうがいたいさくとしては片手落ち

## CSIのtopolofy aware

storageclassにzoneを指定しPVの生成元を指定

## ストレージでのゾーン障害対策

- すとれーじはデータを保持するのが役割の危機
- ゾーン障害対策を持っているストレージが多い
